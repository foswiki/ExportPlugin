"use strict";!function(e){var r={debug:!1,form:".jqExportForm",errorElem:".jqExportErrorMessage",successElem:".jqExportSuccessMessage"};function o(o,t){var s=this;s.$elem=e(o),s.opts=e.extend({},r,t,s.$elem.data()),s.$form=e(s.opts.form),s.$errorElem=e(s.opts.errorElem),s.$successElem=e(s.opts.successElem),s.init()}o.prototype.log=function(){var r,o=this;console&&o.opts.debug&&((r=e.makeArray(arguments)).unshift("EXCEL-EXPORT:"),console.log.apply(console,r))},o.prototype.warn=function(){var r;console&&((r=e.makeArray(arguments)).unshift("EXCEL-EXPORT:"),console.warn.apply(console,r))},o.prototype.init=function(){var r=this;r.$elem.on("click",(function(o){var t;return o.preventDefault(),r.$form.block({message:""}),r.hideMessages(),t=r.serializeForm(),r.validate(t)?(r.log("submitting to backend params=",t),e.jsonRpc(foswiki.getScriptUrlPath("jsonrpc"),{namespace:"ExportPlugin",method:"excel",params:t,error:function(o,t,s){r.showMessage("error",o.error.message,e.i18n("Error")),r.warn("ERROR: code="+o.error.code+", "+o.error.message),r.$form.unblock()},success:function(e,o,t){r.$form.unblock(),r.hideMessages(),void 0!==e.result.redirectUrl&&(window.location.href=e.result.redirectUrl)}})):(r.showMessage("error",e.i18n("There was a validation error")),r.$form.unblock()),!1}))},o.prototype.validate=function(r){var o=!0;return this.$form.find(".required").each((function(){var r=e(this);""===r.val()&&(r.addClass("error"),o=!1)})),r.Topic||(o=!1),o},o.prototype.serializeForm=function(){var r={};return e.each(this.$form.serializeArray(),(function(e,o){""!==o.value&&(r[o.name]=o.value)})),r},o.prototype.showMessage=function(e,r,o){("error"===e?this.$errorElem:this.$successElem).show().html((o?o+": ":"")+r)},o.prototype.hideMessages=function(){var e=this;e.$errorElem.text("").hide(),e.$successElem.text("").hide(),e.$form.find(".error").removeClass("error")},e.fn.excelExport=function(r){return this.each((function(){e.data(this,"ExcelExport")||e.data(this,"ExcelExport",new o(this,r))}))},e((function(){e(".jqExcelExport").livequery((function(){e(this).excelExport()}))}))}(jQuery);
